---
import Layout from '@layouts/Layout.astro';
import ProductGrid from '@components/products/ProductGrid.astro';
import { directus } from '@lib/directus';

export async function getStaticPaths() {
  const { data: categories } = await directus.request(
    readItems('categories', {
      filter: { status: { _eq: 'published' } }
    })
  );
  
  return categories.map(category => ({
    params: { category: category.slug },
    props: { category }
  }));
}

const { category } = Astro.props;

const { data: products } = await directus.request(
  readItems('products', {
    filter: {
      category: { id: { _eq: category.id } },
      status: { _eq: 'published' }
    },
    fields: ['*', { category: ['*'] }, { images: ['directus_files_id'] }]
  })
);
---

<Layout title={`${category.name} | Tu Tienda`}>
  <div class="container mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold mb-8">{category.name}</h1>
    {category.description && (
      <p class="text-gray-600 mb-12 max-w-3xl">{category.description}</p>
    )}
    
    <ProductGrid products={products} />
  </div>
</Layout>